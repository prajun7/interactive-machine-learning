<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive KNN Regression Visualization</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      .container {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
        font-size: 2.2em;
      }
      .controls {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 3px solid #667eea;
        display: flex;
        gap: 30px;
        align-items: flex-start;
      }
      .controls h3 {
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 1.1em;
      }
      .controls-left {
        flex: 1;
      }
      .prediction-side {
        background: #e8f5e8;
        padding: 15px;
        border-radius: 8px;
        border-left: 3px solid #28a745;
        min-width: 200px;
      }
      .prediction-side h4 {
        margin: 0 0 10px 0;
        color: #333;
        font-size: 1em;
      }
      .prediction-side .prediction {
        font-size: 1.4em;
        font-weight: bold;
        color: #28a745;
        margin: 0 0 5px 0;
      }
      .prediction-side .details {
        color: #666;
        font-size: 0.9em;
        margin: 0;
      }
      .slider-container {
        margin: 10px 0;
      }
      label {
        font-weight: 600;
        color: #333;
        display: block;
        margin-bottom: 5px;
        font-size: 0.9em;
      }
      input[type="range"] {
        width: 100%;
        height: 5px;
        border-radius: 3px;
        background: #ddd;
        outline: none;
        -webkit-appearance: none;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: #667eea;
        cursor: pointer;
      }
      .k-value {
        background: #4299e1;
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-weight: bold;
        font-size: 20px;
        display: inline-block;
        margin-left: 10px;
      }
      .plot-area {
        background: #f8f9fa;
        border: 2px solid #ddd;
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
        text-align: center;
      }
      .plot-area h3 {
        margin-bottom: 20px;
        color: #333;
        font-size: 1.3em;
      }
      .steps-container {
        display: flex;
        gap: 20px;
        background: #f0f4f8;
        padding: 20px;
        border-radius: 10px;
        border-top: 5px solid #4299e1;
        margin-top: 20px;
      }
      .step {
        flex: 1;
        background: white;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #4299e1;
        text-align: center;
      }
      .step-number {
        background: #4299e1;
        color: white;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-bottom: 10px;
      }
      .calculation-box {
        background: #e6fffa;
        padding: 20px;
        border-radius: 10px;
        border: 2px solid #81e6d9;
        margin: 20px 0;
        font-family: monospace;
      }
      svg {
        width: 100%;
        height: 500px;
        max-width: 800px;
        margin: 0 auto;
        display: block;
      }
      .data-point {
        cursor: pointer;
        transition: all 0.2s ease;
      }
      .query-point {
        animation: pulse 2s infinite;
      }
      .neighbor {
        stroke-width: 3;
        stroke-dasharray: 5, 5;
        animation: dash 1s linear infinite;
      }
      .distance-line {
        stroke: #ff6b6b;
        stroke-width: 2;
        stroke-dasharray: 3, 3;
        opacity: 0.7;
      }
      .highlight {
        background: #fed7d7;
        padding: 2px 6px;
        border-radius: 4px;
        font-weight: bold;
      }
      .prediction-result {
        background: #d4edda;
        border: 2px solid #28a745;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        margin: 15px 0;
        font-size: 18px;
        font-weight: bold;
        color: #155724;
      }
      @keyframes pulse {
        0% {
          r: 10;
        }
        50% {
          r: 14;
        }
        100% {
          r: 10;
        }
      }
      @keyframes dash {
        to {
          stroke-dashoffset: -10;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div style="margin-bottom: 20px">
        <a
          href="index.html"
          style="
            text-decoration: none;
            color: #667eea;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
          "
        >
          ‚Üê Back to Interactive ML
        </a>
      </div>

      <h1>üìà Interactive K-Nearest Neighbors (KNN) Regression</h1>

      <div class="plot-area">
        <h3>2D Feature Space Visualization</h3>
        <svg id="plot">
          <!-- Grid lines -->
          <defs>
            <pattern
              id="grid"
              width="40"
              height="40"
              patternUnits="userSpaceOnUse"
            >
              <path
                d="M 40 0 L 0 0 0 40"
                fill="none"
                stroke="#e2e8f0"
                stroke-width="1"
              />
            </pattern>
          </defs>
          <rect width="100%" height="100%" fill="url(#grid)" />

          <!-- Axes -->
          <line
            x1="60"
            y1="450"
            x2="550"
            y2="450"
            stroke="#4a5568"
            stroke-width="2"
          />
          <line
            x1="60"
            y1="450"
            x2="60"
            y2="50"
            stroke="#4a5568"
            stroke-width="2"
          />

          <!-- Axis labels -->
          <text
            x="305"
            y="480"
            text-anchor="middle"
            font-size="16"
            fill="#4a5568"
            font-weight="bold"
          >
            Feature X
          </text>
          <text
            x="25"
            y="250"
            text-anchor="middle"
            font-size="16"
            fill="#4a5568"
            font-weight="bold"
            transform="rotate(-90, 25, 250)"
          >
            Feature Y
          </text>

          <!-- Training data points with labels -->
          <g id="training-data">
            <circle cx="120" cy="380" r="7" fill="#3182ce" class="data-point" />
            <text
              x="120"
              y="400"
              text-anchor="middle"
              font-size="11"
              fill="#2d3748"
              font-weight="bold"
            >
              y=2.1
            </text>

            <circle cx="150" cy="300" r="7" fill="#3182ce" class="data-point" />
            <text
              x="150"
              y="285"
              text-anchor="middle"
              font-size="11"
              fill="#2d3748"
              font-weight="bold"
            >
              y=3.8
            </text>

            <circle cx="180" cy="350" r="7" fill="#3182ce" class="data-point" />
            <text
              x="180"
              y="370"
              text-anchor="middle"
              font-size="11"
              fill="#2d3748"
              font-weight="bold"
            >
              y=2.9
            </text>

            <circle cx="220" cy="250" r="7" fill="#3182ce" class="data-point" />
            <text
              x="220"
              y="235"
              text-anchor="middle"
              font-size="11"
              fill="#2d3748"
              font-weight="bold"
            >
              y=5.2
            </text>

            <circle cx="270" cy="220" r="7" fill="#3182ce" class="data-point" />
            <text
              x="270"
              y="205"
              text-anchor="middle"
              font-size="11"
              fill="#2d3748"
              font-weight="bold"
            >
              y=6.1
            </text>

            <circle cx="310" cy="280" r="7" fill="#3182ce" class="data-point" />
            <text
              x="310"
              y="265"
              text-anchor="middle"
              font-size="11"
              fill="#2d3748"
              font-weight="bold"
            >
              y=4.8
            </text>

            <circle cx="350" cy="200" r="7" fill="#3182ce" class="data-point" />
            <text
              x="350"
              y="185"
              text-anchor="middle"
              font-size="11"
              fill="#2d3748"
              font-weight="bold"
            >
              y=6.9
            </text>

            <circle cx="400" cy="170" r="7" fill="#3182ce" class="data-point" />
            <text
              x="400"
              y="155"
              text-anchor="middle"
              font-size="11"
              fill="#2d3748"
              font-weight="bold"
            >
              y=7.8
            </text>

            <circle cx="430" cy="140" r="7" fill="#3182ce" class="data-point" />
            <text
              x="430"
              y="125"
              text-anchor="middle"
              font-size="11"
              fill="#2d3748"
              font-weight="bold"
            >
              y=8.5
            </text>

            <circle cx="470" cy="110" r="7" fill="#3182ce" class="data-point" />
            <text
              x="470"
              y="95"
              text-anchor="middle"
              font-size="11"
              fill="#2d3748"
              font-weight="bold"
            >
              y=9.2
            </text>

            <circle cx="160" cy="400" r="7" fill="#3182ce" class="data-point" />
            <text
              x="160"
              y="420"
              text-anchor="middle"
              font-size="11"
              fill="#2d3748"
              font-weight="bold"
            >
              y=1.9
            </text>

            <circle cx="240" cy="320" r="7" fill="#3182ce" class="data-point" />
            <text
              x="240"
              y="305"
              text-anchor="middle"
              font-size="11"
              fill="#2d3748"
              font-weight="bold"
            >
              y=3.7
            </text>
          </g>

          <!-- Query point -->
          <circle
            cx="290"
            cy="290"
            r="10"
            fill="#e53e3e"
            stroke="#c53030"
            stroke-width="3"
            class="query-point"
          />

          <!-- Distance lines and neighbors (dynamically added) -->
          <g id="distance-lines"></g>
          <g id="neighbors"></g>
          <g id="labels"></g>

          <!-- Legend -->
          <g transform="translate(80, 80)">
            <rect
              x="-15"
              y="-10"
              width="200"
              height="90"
              fill="white"
              stroke="#cbd5e0"
              stroke-width="2"
              rx="8"
            />
            <circle cx="10" cy="10" r="7" fill="#3182ce" />
            <text
              x="25"
              y="15"
              font-size="13"
              fill="#4a5568"
              font-weight="bold"
            >
              Training Data
            </text>
            <circle cx="10" cy="35" r="10" fill="#e53e3e" />
            <text
              x="25"
              y="40"
              font-size="13"
              fill="#4a5568"
              font-weight="bold"
            >
              Query Point
            </text>
            <circle
              cx="10"
              cy="60"
              r="7"
              fill="#38a169"
              stroke="#2d7d3c"
              stroke-width="3"
            />
            <text
              x="25"
              y="65"
              font-size="13"
              fill="#4a5568"
              font-weight="bold"
            >
              K Nearest Neighbors
            </text>
          </g>
        </svg>
      </div>

      <div class="controls">
        <div class="controls-left">
          <h3>Interactive Controls</h3>
          <div class="slider-container">
            <label for="kValue">
              Select K (Number of Neighbors):
              <span class="k-value" id="kValueDisplay">5</span>
            </label>
            <input
              type="range"
              id="kValue"
              min="1"
              max="12"
              value="5"
              oninput="updateKNN()"
            />
          </div>
          <div style="margin-top: 15px; font-size: 0.9em; color: #666">
            <strong>Query Point:</strong> (290, 290) ‚Üí
            <span style="color: #e53e3e; font-weight: bold">y = ?</span><br />
            <strong>Training Data:</strong> 12 points with known y-values
          </div>
        </div>
        <div class="prediction-side">
          <h4>üìä Current Prediction</h4>
          <p class="prediction" id="sidePrediction">≈∑ = 4.800</p>
          <p class="details" id="sideDetails">Average of 5 nearest neighbors</p>
        </div>
      </div>

      <div
        class="calculation-box"
        id="calculation-details"
        style="display: none"
      ></div>

      <div class="steps-container">
        <div class="step">
          <div class="step-number">1</div>
          <h4>Calculate Distances</h4>
          <p>
            Compute Euclidean distance from query point to all training points:
            d = ‚àö[(x‚ÇÅ-x‚ÇÇ)¬≤ + (y‚ÇÅ-y‚ÇÇ)¬≤]
          </p>
        </div>

        <div class="step">
          <div class="step-number">2</div>
          <h4>Sort & Select K</h4>
          <p>
            Sort all distances in ascending order and select the K closest
            training points as neighbors.
          </p>
        </div>

        <div class="step">
          <div class="step-number">3</div>
          <h4>Extract Y-Values</h4>
          <p>
            Get the target values (y-values) of the K nearest neighbors for
            regression calculation.
          </p>
        </div>

        <div class="step">
          <div class="step-number">4</div>
          <h4>Calculate Average</h4>
          <p>
            Compute the mean of the K target values: ≈∑ = (y‚ÇÅ + y‚ÇÇ + ... + y‚Çñ) /
            K
          </p>
        </div>
      </div>
    </div>

    <script>
      // Training data points with coordinates and y-values
      const trainingData = [
        { x: 120, y: 380, value: 2.1, cx: 120, cy: 380 },
        { x: 150, y: 300, value: 3.8, cx: 150, cy: 300 },
        { x: 180, y: 350, value: 2.9, cx: 180, cy: 350 },
        { x: 220, y: 250, value: 5.2, cx: 220, cy: 250 },
        { x: 270, y: 220, value: 6.1, cx: 270, cy: 220 },
        { x: 310, y: 280, value: 4.8, cx: 310, cy: 280 },
        { x: 350, y: 200, value: 6.9, cx: 350, cy: 200 },
        { x: 400, y: 170, value: 7.8, cx: 400, cy: 170 },
        { x: 430, y: 140, value: 8.5, cx: 430, cy: 140 },
        { x: 470, y: 110, value: 9.2, cx: 470, cy: 110 },
        { x: 160, y: 400, value: 1.9, cx: 160, cy: 400 },
        { x: 240, y: 320, value: 3.7, cx: 240, cy: 320 },
      ];

      const queryPoint = { x: 290, y: 290 };

      function updateKNN() {
        const k = parseInt(document.getElementById("kValue").value);
        document.getElementById("kValueDisplay").textContent = k;

        // Calculate distances
        const distances = trainingData.map((point) => ({
          ...point,
          distance: Math.sqrt(
            Math.pow(point.x - queryPoint.x, 2) +
              Math.pow(point.y - queryPoint.y, 2)
          ),
        }));

        // Sort by distance and get k nearest
        distances.sort((a, b) => a.distance - b.distance);
        const nearestK = distances.slice(0, k);

        // Clear previous visualizations
        document.getElementById("distance-lines").innerHTML = "";
        document.getElementById("neighbors").innerHTML = "";
        document.getElementById("labels").innerHTML = "";

        const svg = document.getElementById("plot");
        const distanceLinesGroup = document.getElementById("distance-lines");
        const neighborsGroup = document.getElementById("neighbors");
        const labelsGroup = document.getElementById("labels");

        // Calculate average
        const avgValue =
          nearestK.reduce((sum, p) => sum + p.value, 0) / nearestK.length;

        // Update side prediction
        const sidePredictionEl = document.getElementById("sidePrediction");
        const sideDetailsEl = document.getElementById("sideDetails");

        if (sidePredictionEl) {
          sidePredictionEl.textContent = `≈∑ = ${avgValue.toFixed(3)}`;
        }
        if (sideDetailsEl) {
          sideDetailsEl.textContent = `Average of ${k} nearest neighbors`;
        }

        // Show calculation details
        const calcDiv = document.getElementById("calculation-details");
        calcDiv.style.display = "block";

        let calcHTML = `<strong>Detailed Calculation for K=${k}:</strong><br><br>`;
        calcHTML += `<div style="background: #f7fafc; padding: 15px; border-radius: 5px; margin: 10px 0;">`;
        calcHTML += `<strong>Selected ${k} Nearest Neighbors (sorted by distance):</strong><br><br>`;

        nearestK.forEach((point, index) => {
          calcHTML += `<div style="margin: 5px 0; padding: 5px; background: white; border-radius: 3px;">`;
          calcHTML += `${index + 1}. Point (${point.x}, ${point.y}) ‚Üí y = ${
            point.value
          }, distance = ${point.distance.toFixed(2)}`;
          calcHTML += `</div>`;
        });

        calcHTML += `</div>`;
        calcHTML += `<div style="background: #e6fffa; padding: 15px; border-radius: 5px; margin-top: 15px;">`;
        calcHTML += `<strong>Average Calculation:</strong><br><br>`;
        calcHTML += `<div style="font-family: monospace; line-height: 1.6;">`;
        calcHTML += `≈∑ = (${nearestK
          .map((p) => p.value)
          .join(" + ")}) / ${k}<br>`;
        calcHTML += `≈∑ = ${nearestK
          .reduce((sum, p) => sum + p.value, 0)
          .toFixed(1)} / ${k}<br>`;
        calcHTML += `<span style="background: #fed7d7; padding: 8px; border-radius: 3px; font-weight: bold; font-size: 18px; display: inline-block; margin-top: 5px;">≈∑ = ${avgValue.toFixed(
          3
        )}</span>`;
        calcHTML += `</div>`;
        calcHTML += `</div>`;

        calcDiv.innerHTML = calcHTML;

        // Visualize neighbors
        nearestK.forEach((point, index) => {
          // Add distance line
          const line = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "line"
          );
          line.setAttribute("x1", queryPoint.x);
          line.setAttribute("y1", queryPoint.y);
          line.setAttribute("x2", point.cx);
          line.setAttribute("y2", point.cy);
          line.setAttribute("class", "distance-line");
          distanceLinesGroup.appendChild(line);

          // Highlight neighbor
          const circle = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "circle"
          );
          circle.setAttribute("cx", point.cx);
          circle.setAttribute("cy", point.cy);
          circle.setAttribute("r", 7);
          circle.setAttribute("fill", "#38a169");
          circle.setAttribute("class", "neighbor");
          circle.setAttribute("stroke", "#2d7d3c");
          neighborsGroup.appendChild(circle);

          // Add rank label
          const rankLabel = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "text"
          );
          rankLabel.setAttribute("x", point.cx + 15);
          rankLabel.setAttribute("y", point.cy - 12);
          rankLabel.setAttribute("font-size", "12");
          rankLabel.setAttribute("fill", "#2d7d3c");
          rankLabel.setAttribute("font-weight", "bold");
          rankLabel.setAttribute("stroke", "white");
          rankLabel.setAttribute("stroke-width", "2");
          rankLabel.setAttribute("paint-order", "stroke");
          rankLabel.textContent = `#${index + 1}`;
          labelsGroup.appendChild(rankLabel);

          // Add distance label
          const midX = (queryPoint.x + point.cx) / 2;
          const midY = (queryPoint.y + point.cy) / 2;
          const distanceLabel = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "text"
          );
          distanceLabel.setAttribute("x", midX);
          distanceLabel.setAttribute("y", midY - 5);
          distanceLabel.setAttribute("text-anchor", "middle");
          distanceLabel.setAttribute("font-size", "10");
          distanceLabel.setAttribute("fill", "#e53e3e");
          distanceLabel.setAttribute("font-weight", "bold");
          distanceLabel.setAttribute("stroke", "white");
          distanceLabel.setAttribute("stroke-width", "1");
          distanceLabel.setAttribute("paint-order", "stroke");
          distanceLabel.textContent = `d=${point.distance.toFixed(1)}`;
          labelsGroup.appendChild(distanceLabel);
        });
      }

      // Initialize with k=5
      updateKNN();
    </script>
  </body>
</html>
